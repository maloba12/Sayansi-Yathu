// Service Worker Registration for PWA
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
        .then(registration => {
            console.log('Service Worker registered successfully:', registration);
        })
        .catch(error => {
            console.log('Service Worker registration failed:', error);
        });
}

// Navigation and UI interactions
document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');

    if (navToggle && navMenu) {
        navToggle.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });
    }

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                e.preventDefault();
                target.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });
});

// User authentication check (temporarily disabled - was causing page blinking)
// function checkAuth() {
//     const token = localStorage.getItem('authToken');
//     if (!token && !window.location.pathname.includes('index.html')) {
//         window.location.href = '/';
//     }
// }

// checkAuth();

// Experiment navigation function
function loadExperiment(subject) {
    // Navigate to the appropriate experiment page based on subject
    switch(subject) {
        case 'physics':
            window.location.href = 'experiments/physics.html';
            break;
        case 'chemistry':
            window.location.href = 'experiments/chemistry.html';
            break;
        case 'biology':
            window.location.href = 'experiments/biology.html';
            break;
        default:
            console.error('Unknown experiment subject:', subject);
    }
}

// Backend test function
function testBackend() {
    const resultDiv = document.getElementById('api-result');
    if (!resultDiv) {
        console.error('API result div not found');
        return;
    }
    
    resultDiv.innerHTML = 'Testing backend connection...';
    
    // Test PHP backend
    fetch('http://localhost:8080/api/health', {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        resultDiv.innerHTML = '<div style="color: green;">✅ PHP Backend: ' + JSON.stringify(data, null, 2) + '</div>';
    })
    .catch(error => {
        resultDiv.innerHTML = '<div style="color: red;">❌ PHP Backend Error: ' + error.message + '</div>';
    });
    
    // Test Python backend (if running)
    fetch('http://localhost:5000/api/health', {
        method: 'GET',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        resultDiv.innerHTML += '<div style="color: green;">✅ Python Backend: ' + JSON.stringify(data, null, 2) + '</div>';
    })
    .catch(error => {
        resultDiv.innerHTML += '<div style="color: orange;">⚠️ Python Backend: Not running or ' + error.message + '</div>';
    });
}

console.log('Sayansi Yathu main.js loaded successfully');
